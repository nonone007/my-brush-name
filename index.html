<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>جرب وكتّب اسمك !</title>

  <!-- Inject <base href="/just/"> only when running under /just on fazavip.tn -->
  <script>
    (function () {
      try {
        var u = new URL(window.location.href);
        // Adjust condition if you also want it active on www.fazavip.tn
        if (u.hostname.endsWith("fazavip.tn") && u.pathname.startsWith("/just")) {
          var base = document.createElement("base");
          base.setAttribute("href", "/just/");
          document.head.prepend(base);
        }
      } catch (_) {}
    })();
  </script>

  <!-- html2canvas for screenshots (kept as-is) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

  <style>
    /* Fonts (local files, relative paths) */
    @font-face {
      font-family: 'Ar1';
      src: url('FONT.AR.1.ttf') format('truetype');
      font-display: swap;
    }
    @font-face {
      font-family: 'Ar2';
      src: url('FONT.AR.2.ttf') format('truetype');
      font-display: swap;
    }
    @font-face {
      font-family: 'Ar3';
      src: url('FONT.AR.3.otf') format('opentype');
      font-display: swap;
    }
    @font-face {
      font-family: 'Fr1';
      src: url('FONT.FR.1.otf') format('opentype');
      font-display: swap;
    }
    @font-face {
      font-family: 'Fr2';
      src: url('FONT.FR.2.ttf') format('truetype');
      font-display: swap;
    }
    /* Note: your "Fr3" maps to AR.3 file per your original code */
    @font-face {
      font-family: 'Fr3';
      src: url('FONT.AR.3.otf') format('opentype');
      font-display: swap;
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image: url('BG.png'); /* relative path */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .main-container {
      display:flex; max-width:1400px; width:100%; gap:40px; align-items:flex-start;
      opacity:0; animation:fadeIn 1s ease-out 0.5s forwards;
    }

    .brush-section { flex:1; display:flex; flex-direction:column; align-items:center; }
    .brush-container { position:relative; width:100%; max-width:1000px; margin-bottom:30px; transition: transform .3s ease; }
    .brush-container:hover{ transform: scale(1.02); }

    .brush-image {
      width:100%; height:auto; display:block;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,.3));
    }

    .text-overlay{
      position:absolute; top:48%; left:35%; transform:translate(-50%,-50%);
      font-size: clamp(28px, 11.2vw, 84px);
      font-weight:bold; color:#1a1a1a; text-align:center; width:70%;
      text-shadow:2px 2px 4px rgba(255,255,255,.8);
      line-height:1.2; transition: all .3s ease;
      word-wrap:break-word; overflow-wrap: break-word;
    }
    .text-overlay.arabic-font{ font-size: clamp(32px, 10vw, 84px); }
    .text-overlay.long-text{ font-size: clamp(25px, 8.4vw, 59px); }
    .text-overlay.very-long-text{ font-size: clamp(22px, 7vw, 45px); }
    @media (min-width:1024px){
      .text-overlay.arabic-font{ font-size:100px; }
      .text-overlay.arabic-font.long-text{ font-size:80px; }
      .text-overlay.arabic-font.very-long-text{ font-size:60px; }
    }

    .controls-panel{
      background: rgba(255,255,255,.95);
      backdrop-filter: blur(20px);
      border-radius:25px; padding:35px;
      box-shadow: 0 25px 50px rgba(0,0,0,.15);
      border:1px solid rgba(255,255,255,.3);
      width:400px; position:sticky; top:100px; margin-top:50px;
      transition: all .3s ease;
    }
    .controls-panel:hover{ transform: translateY(-5px); box-shadow: 0 30px 60px rgba(0,0,0,.2); }

    .panel-title{
      font-size:24px; font-weight:700; color:#2c3e50; margin-bottom:25px; text-align:center; position:relative;
    }
    .panel-title::after{
      content:''; position:absolute; bottom:-8px; left:50%; transform:translateX(-50%);
      width:60px; height:3px; background:linear-gradient(90deg,#3498db,#9b59b6); border-radius:2px;
    }

    .input-group{ margin-bottom:25px; position:relative; }
    .input-label{ display:block; font-weight:600; color:#34495e; margin-bottom:8px; font-size:14px; transition: all .3s ease; }
    .text-input{
      width:100%; padding:15px 12px; border:2px solid #e0e6ed; border-radius:12px; font-size:16px;
      transition: all .3s ease; background:rgba(255,255,255,.9); text-align:left; text-indent:0;
    }
    .text-input::placeholder{ color:#95a5a6; text-align:left; }
    .text-input:focus{ outline:none; border-color:#3498db; box-shadow:0 0 0 3px rgba(52,152,219,.1); transform:translateY(-2px); }
    .text-input:focus + .input-label,
    .text-input:not(:placeholder-shown) + .input-label{
      transform: translateY(-25px) scale(.85); color:#3498db;
    }

    .font-select{
      width:100%; padding:15px 18px; border:2px solid #e0e6ed; border-radius:12px; font-size:16px;
      background:rgba(255,255,255,.9); cursor:pointer; transition: all .3s ease; appearance:none;
      background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat:no-repeat; background-position:right 15px center; background-size:16px; padding-right:45px;
    }
    .font-select:focus{
      outline:none; border-color:#3498db; box-shadow:0 0 0 3px rgba(52,152,219,.1);
      transform: translateY(-2px);
    }

    .confirm-btn{
      width:100%; padding:16px 24px; background:linear-gradient(135deg,#3498db,#2980b9);
      color:#fff; border:none; border-radius:12px; font-size:16px; font-weight:600; cursor:pointer;
      transition: all .3s ease; box-shadow:0 4px 15px rgba(52,152,219,.3); position:relative; overflow:hidden;
    }
    .confirm-btn::before{
      content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent); transition:left .5s;
    }
    .confirm-btn:hover::before{ left:100%; }
    .confirm-btn:hover{ transform:translateY(-3px); box-shadow:0 8px 25px rgba(52,152,219,.4); background:linear-gradient(135deg,#2980b9,#1f5f8b); }
    .confirm-btn:active{ transform:translateY(-1px); }

    .screenshot-btn{
      width:100%; padding:16px 24px; background:linear-gradient(135deg,#27ae60,#2ecc71);
      color:#fff; border:none; border-radius:12px; font-size:16px; font-weight:600; cursor:pointer;
      transition: all .3s ease; box-shadow:0 4px 15px rgba(39,174,96,.3); margin-top:15px; position:relative; overflow:hidden;
    }
    .screenshot-btn:hover{ transform: translateY(-3px); box-shadow:0 8px 25px rgba(39,174,96,.4); background:linear-gradient(135deg,#2ecc71,#27ae60); }
    .screenshot-btn:active{ transform:translateY(-1px); }

    .message-container{ min-height:60px; display:flex; align-items:center; justify-content:center; }
    .success-message{
      background:linear-gradient(135deg,#27ae60,#2ecc71);
      color:#fff; padding:12px 20px; border-radius:25px; font-weight:600;
      box-shadow:0 4px 15px rgba(39,174,96,.3); animation:bounceIn .6s ease-out;
    }
    .error-message{
      background:linear-gradient(135deg,#e74c3c,#c0392b);
      color:#fff; padding:12px 20px; border-radius:25px; font-weight:600;
      box-shadow:0 4px 15px rgba(231,76,60,.3); animation:shake .6s ease-out;
      display:none;
    }

    .preview-text{ font-size:18px; color:#7f8c8d; text-align:center; margin-top:15px; font-style:italic; }

    @keyframes fadeIn{ from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);} }
    @keyframes bounceIn{ 0%{transform:scale(.3); opacity:0;} 50%{transform:scale(1.05);} 70%{transform:scale(.9);} 100%{transform:scale(1); opacity:1;} }
    @keyframes shake{
      0%,100%{ transform: translateX(0); }
      10%,30%,50%,70%,90%{ transform: translateX(-5px); }
      20%,40%,60%,80%{ transform: translateX(5px); }
    }

    .back-button{
      position:fixed; top:30px; left:30px; background:linear-gradient(135deg,#3498db,#2980b9);
      color:#fff; border:none; border-radius:50px; padding:15px 25px; font-size:16px; font-weight:600; cursor:pointer;
      transition: all .3s ease; box-shadow:0 4px 15px rgba(52,152,219,.3); text-decoration:none; display:flex; align-items:center; gap:10px; z-index:1000;
    }
    .back-button:hover{ transform:translateY(-3px); box-shadow:0 8px 25px rgba(52,152,219,.4); background:linear-gradient(135deg,#2980b9,#1f5f8b); }
    .back-button:active{ transform:translateY(-1px); }
    .back-button .arrow{ font-size:18px; transition:transform .3s ease; }
    .back-button:hover .arrow{ transform: translateX(-3px); }

    @media (max-width:1200px){
      .main-container{ flex-direction:column; align-items:center; gap:25px; }
      .controls-panel{ width:100%; max-width:500px; position:static; margin-top:80px; backdrop-filter: blur(15px); }
    }
    @media (max-width:768px){
      body{ padding:15px; }
      .brush-container{ max-width:600px; }
      .text-overlay{ width:80%; left:35%; top:48%; transform: translate(-50%,-50%) scale(var(--mobile-scale,1)); font-size:38px; }
      .controls-panel{ padding:25px; backdrop-filter: blur(10px); border-radius:20px; }
    }
    @media (max-width:480px){
      .brush-container{ max-width:450px; }
      .text-overlay{ width:85%; left:35%; top:48%; transform: translate(-50%,-50%) scale(var(--mobile-scale,1)); font-size:30px; }
      .controls-panel{ padding:20px; }
    }

    /* Particles */
    .particles{ position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:-1; }
    .particle{ position:absolute; width:4px; height:4px; background: rgba(52,152,219,.3); border-radius:50%; animation: float 6s ease-in-out infinite; }
    @keyframes float{
      0%,100%{ transform: translateY(0) rotate(0); opacity:0; }
      10%{ opacity:1; } 90%{ opacity:1; }
      100%{ transform: translateY(-100px) rotate(360deg); opacity:0; }
    }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>

  <a href="https://fazaviptn.youcan.store/pages/brosses-a-cheveux" class="back-button">
    <span class="arrow">←</span> الرجوع إلى المتجر
  </a>

  <div class="main-container">
    <div class="brush-section">
      <div class="brush-container">
        <img src="BRUSH.NO.BG.png" alt="Decorative Brush" class="brush-image"/>
        <div class="text-overlay" id="textOverlay"></div>
      </div>
    </div>

    <div class="controls-panel">
      <h2 class="panel-title">! جرب وكتّب اسمك</h2>

      <div class="input-group">
        <label for="nameInput" class="input-label">: أكتب الاسم بالعربي او الفرنسي</label>
        <input type="text" id="nameInput" class="text-input" placeholder="أكتب اسمك هنا..." maxlength="15" autocomplete="off"/>
      </div>

      <div class="input-group">
        <label for="fontSelect" class="input-label">: اختر نمط الخط</label>
        <select id="fontSelect" class="font-select">
          <option value="" selected disabled hidden>-- اختر من هنا --</option>
          <option value="Ar1">خط عربي 1</option>
          <option value="Ar2">خط عربي 2</option>
          <option value="Ar3">خط عربي 3</option>
          <option value="Fr1">خط فرنسي 1</option>
          <option value="Fr2">خط فرنسي 2</option>
          <option value="Fr3">خط فرنسي 3</option>
        </select>
      </div>

      <button id="confirmBtn" class="confirm-btn">اضغط هنا</button>

      <div class="message-container">
        <div id="message" class="error-message"></div>
      </div>

      <div class="shortcuts-hint">💡 نصيحة: اضغط Enter لكتابة الاسم</div>
    </div>
  </div>

  <script>
    const nameInput = document.getElementById('nameInput');
    const fontSelect = document.getElementById('fontSelect');
    const confirmBtn = document.getElementById('confirmBtn');
    const textOverlay = document.getElementById('textOverlay');
    const message = document.getElementById('message');

    const arabicFonts = ['Ar1','Ar2','Ar3'];
    const mobileFontScale = { 'Ar1':1.6, 'Ar2':1.6, 'Ar3':1.6, 'Fr1':1, 'Fr2':1, 'Fr3':1 };

    const errorMessages = {
      tooLong: "الاسم يجب أن لا يتجاوز 15 حرفاً",
      empty: "الرجاء كتابة اسم",
      noFont: "الرجاء اختيار نمط الخط"
    };
    const successMessages = { success: "! تمت التجربة بنجاح", ready: "! جاهز للتحميل" };

    function showMessage(text, type) {
      message.textContent = text;
      message.className = type;
      message.style.display = 'block';
    }
    function hideMessage(){ message.style.display='none'; }

    function adjustTextSize(text){
      textOverlay.classList.remove('long-text','very-long-text');
      if (text.length > 10) textOverlay.classList.add('very-long-text');
      else if (text.length > 6) textOverlay.classList.add('long-text');
    }

    function updateText(){
      const name = nameInput.value.trim();
      const selectedFont = fontSelect.value;

      if (name === '') { showMessage(errorMessages.empty,'error-message'); textOverlay.textContent=''; return; }
      if (name.length > 15) { showMessage(errorMessages.tooLong,'error-message'); textOverlay.textContent=''; return; }
      if (!selectedFont) { showMessage(errorMessages.noFont,'error-message'); return; }

      const isMobile = window.matchMedia && (window.matchMedia('(max-width: 768px)').matches || window.matchMedia('(max-width: 480px)').matches);
      const scale = mobileFontScale[selectedFont] || 1;
      if (isMobile) textOverlay.style.setProperty('--mobile-scale', scale);
      else textOverlay.style.removeProperty('--mobile-scale');

      textOverlay.style.fontFamily = selectedFont;
      if (arabicFonts.includes(selectedFont)) textOverlay.classList.add('arabic-font');
      else textOverlay.classList.remove('arabic-font');

      textOverlay.textContent = name;
      adjustTextSize(name);

      textOverlay.classList.add('animate');
      setTimeout(()=> textOverlay.classList.remove('animate'), 500);

      showMessage(successMessages.success,'success-message');
    }

    confirmBtn.addEventListener('click', updateText);
    nameInput.addEventListener('input', hideMessage);
    nameInput.addEventListener('keypress', e => { if (e.key === 'Enter') updateText(); });
    fontSelect.addEventListener('change', () => { if (textOverlay.textContent) updateText(); });

    nameInput.addEventListener('focus', function(){ this.select(); this.setSelectionRange(0,0); });

    // Particles
    function initParticles(){
      const particlesContainer = document.getElementById('particles');
      const particleCount = 15;
      for (let i=0; i<particleCount; i++) createParticle(particlesContainer);
    }
    function createParticle(container){
      const p = document.createElement('div');
      p.className='particle';
      p.style.left = Math.random()*100 + '%';
      p.style.animationDelay = Math.random()*6 + 's';
      p.style.animationDuration = (Math.random()*3 + 4) + 's';
      container.appendChild(p);
      setTimeout(()=>{ if (p.parentNode){ p.remove(); createParticle(container); } }, 8000);
    }

    window.addEventListener('load', function(){
      document.body.style.opacity='0';
      setTimeout(()=>{ document.body.style.transition='opacity 1s ease-in'; document.body.style.opacity='1'; }, 100);
      initParticles();

      // quick console checks for assets
      const testImg = new Image();
      testImg.onload = ()=> console.log('✅ BRUSH image loaded', testImg.naturalWidth,'x',testImg.naturalHeight);
      testImg.onerror = ()=> console.warn('❌ BRUSH image failed to load (check path/case)');
      testImg.src = 'BRUSH.NO.BG.png';
    });

    // Default font selection (keeps your previous behavior)
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('fontSelect').selectedIndex = 0; // "-- اختر من هنا --"
    });
  </script>
</body>
</html>
